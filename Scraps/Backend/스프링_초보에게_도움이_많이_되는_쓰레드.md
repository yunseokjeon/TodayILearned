스프링 초보에게 도움이 많이 되는 쓰레드. 이런 경험에서 나오는 지식을 공유를 해주시니 감사할 따름이다.

https://twitter.com/jason7ko/status/1449195205551288328

Java/Spring 하면서 가장 지겨운 건 컨트롤러-서비스-리포지토리를 맨날 만든다는 건데, 이건 본인이 만들고 있으면서 지겹다고 투덜대고 있는거라 누굴 욕할 수도 없는 일. 그래서 요즘은 코딩 짝과 함께 별로 새로울 것 없는 새로운 시도를 해보고 있다. 메소드를 딱 한 개만 갖는 서비스 클래스.

https://twitter.com/John_Grib/status/1449003690015145986

가령 게시판을 만든다고 하자. 1~2년차의 나는 BoardService 이런걸 만들고 이 녀석에 모든 메소드를 쑤셔넣고, 클래스가 600줄 넘어가도록 불안하게 방치하곤 했다. 그 외의 방법이 떠오르지 않았다. 5년차의 나는? 이걸 둘로 쪼개고 command, query로 나눴다. 반으로 나뉘었을 뿐 큰 차이는 없었다.

https://twitter.com/John_Grib/status/1449004546462674955

그 이후로도 크게 다르지 않았는데, 어느날 단일책임원칙은 좀 지키고 살아야 하지 않겠나 하는 생각이 들었다. 그래서 그냥 서비스 하나가 퍼블릭 메소드 하나만 서비스하도록 해봤더니 생각보다 괜찮았다. 테스트 클래스도 메소드 하나만 테스트하는 내용으로 채워지게 되어서 제법 읽기 좋았다.

https://twitter.com/John_Grib/status/1449005299164008449

그리고 서비스 이름에 모두 er 을 붙였다. 엘레강트 오브젝트 읽은 분들은 어 그러면 안 좋은데.. 라고 조언해주셨지만, 난 객체지향 별로 안 좋아하고, 내가 좋아했던 Go에서는 인터페이스 이름에 er 붙이는 게 당연했는데 뭔 상관인가 하고 걍 서비스 이름을 그렇게 지었다.

https://twitter.com/John_Grib/status/1449005625388666887

게시판 서비스 예제로 돌아가보자. 이렇게 하면 서비스가 촘촘하게 분리된다. BoardCreator, CommentCreator, CommentDeleter, ... 같은 녀석들이 서비스가 된다. 메소드가 하나이기 때문에 이 클래스들은 사실 메소드 하나를 제공하기 위한 껍데기일 뿐이다. 그리고 이름만 봐도 용도가 뻔하다.

https://twitter.com/John_Grib/status/1449006168123138051

클래스 하나가 30줄을 안 넘으니 파일 열어보면 오래 걸려도 5초 안에 뭐하는 파일인지 바로 파악이 된다. er 달린 녀석들끼리 이름으로 구분이 되니 읽는 사람의 마음속에서 er-layer 가 구분된다는 것도 특징. 테스트 코드도 심플해진다. 파일이 많아지는 건 단점일 수도 있는데, 난 신경 안 쓴다.

https://twitter.com/John_Grib/status/1449006652447813633

그리고 레거시에서 DTO 레이어마다 일일이 new 생성해서 들려보내는 걸 보는 것도 너무 짜증나는 일이라, 레이어별로 콘크리트 클래스를 받지 않고 전부 인터페이스로 받게 바꾸고 적당한 팩토리 하나 만들어서 new DTO를 볼 때마다 삭제해버렸다. 팩토리는 내부에 프라이빗 구현체 하나 갖고 있고

https://twitter.com/John_Grib/status/1449007197149491200

용도별로 호출할 수 있는 이름 적당한 메소드 여러개를 서비스하는 방식. 이렇게만 해도 파일을 많이 지울 수 있었기 때문에 er 클래스로 파일이 늘어나도 삭제한 게 많아서 거기서 거기인 느낌.

https://twitter.com/John_Grib/status/1449007476318171136

그래서 이번 프로젝트에서는 service 포스트픽스가 붙은 클래스가 1개도 없다. 이런 서비스 클래스 패키지 경로 전략도 철저하게 탐색 편의 위주로 고려했기 때문에 /생물/동물/포유류/강아지 이런 식의 개념적 계층화만 염두에 두고 만들어서 찾기도 쉽다. 이러면 접근권한 붙이기가 좀 짜증나는데

https://twitter.com/John_Grib/status/1449009935522537475

내가 자바에서 항상 필요하다고 생각하는 건 하위 경로에만 열려 있는 recursive private 인데, 사실 자바의 패키지 접근권한 개념은 내가 바람직하다고 생각하는 것과 개념이 달라서 이건 앞으로도 추가될 일이 없을 것 같다. 아무튼 그래서 클래스는 default 아니면 public으로만 쓴다.

https://twitter.com/John_Grib/status/1449010556300451859

한편으로는 퍼블릭이어도 큰 문제가 없는 구성이라 생각. 클래스 이름으로 용도를 광고하고 있는 메소드 딱 한 개만 지원하는데 퍼블릭이면 어떻단 말인가 하는 생각. 패키지 접근제한으로 멍청한 개발자를 방지하는 건 자바의 철학이지만, 나는 가독성이 개발자의 아이큐를 끌어올린다고 생각한다.

https://twitter.com/John_Grib/status/1449011302496563200

avadoc을 좋아하고 성실히 적으려는 이유도 같은 근거. 테스트 코드에서는 필요하다면 한글도 최대한 쓴다. 픽스쳐 이름도 한글로 지어버림. 알아보는 게 제일 중요하다. 계속 옆 동료에게 쉽게 읽히냐고 물어보고 잘 모르겠다고 하면 기각하고 다른 걸로. 코드 모양에 대한 내 고집은 덜 중요하다.

https://twitter.com/John_Grib/status/1449013513096101892

